{"version":3,"file":"index.iife.js","sources":["../index.js"],"sourcesContent":["export const withInstances = (internal, { Workflow, Tinyflow, TinyflowError }) => {\n  internal.instances = new Map()\n  const { instances, listeners } = internal\n\n  /**\n   * Gets a workflow instance by its id\n   * @method\n   * @param id {string}\n   * @returns {Workflow}\n   */\n  Tinyflow.get = id => instances.get(id)\n\n  /**\n   * Returns all non-disposed workflows of any state.\n   * @method\n   * @return {Workflow[]}\n   */\n  Tinyflow.all = () => [...instances.values()]\n\n  /**\n   * Clears all instances. By default, all engines are shut down\n   * and fire the end event.\n   * @method\n   */\n  Tinyflow.clear = () => {\n    const ids = [...instances.keys()]\n    for (const instanceId of ids) {\n      const workflow = Tinyflow.get(instanceId)\n      workflow.cancel()\n      Tinyflow.dispose(instanceId)\n    }\n  }\n\n  /**\n   * Creates a new workflow instance by given workflow definitions.\n   *\n   * @param definition {object} the workflow definitions object\n   * @returns {Workflow}\n   */\n  Tinyflow.create = (definition) => {\n    const workflow = new Workflow(definition)\n    instances.set(workflow.id, workflow)\n    return workflow\n  }\n\n  /**\n   * Fully disposes a workflow, including any event listener\n   * to it, or its current step.\n   * Once complete it will finally remove the workflow from\n   * the internal instances list.\n   * @param instanceId {string}\n   * @param force {boolean=}\n   */\n  Tinyflow.dispose = (instanceId, { force = false } = {}) => {\n    const workflow = instances.get(instanceId)\n    if (!workflow) {\n      throw new TinyflowError(`Workflow does not exist by id ${instanceId}`)\n    }\n    if (!force && workflow.state === 'active') {\n      throw new TinyflowError(`Cannot dispose active workflow \"${workflow.name}\"`, { instanceId })\n    }\n    if (workflow.current) {\n      workflow.current.off()\n      workflow.current = null\n    }\n    workflow.off()\n    listeners.delete(workflow)\n    instances.delete(instanceId)\n  }\n\n  // dispose method for complete cleanup of this extension\n  return () => {\n    delete internal.instances\n    delete Tinyflow.get\n    delete Tinyflow.all\n    delete Tinyflow.clear\n    delete Tinyflow.create\n    delete Tinyflow.dispose\n  }\n}\n"],"names":["withInstances","internal","_ref","Workflow","Tinyflow","TinyflowError","instances","Map","listeners","get","id","all","_toConsumableArray","values","clear","ids","keys","_iterator","_createForOfIteratorHelper","_step","s","n","done","instanceId","value","workflow","cancel","dispose","err","e","f","create","definition","set","_ref2","arguments","length","undefined","_ref2$force","force","concat","state","name","current","off"],"mappings":"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"}