{"version":3,"file":"index.cjs.js","sources":["../utils.js"],"sourcesContent":["export const simpleId = () => Math.random().toString(36).substring(2, 16)\n\nexport const asyncTimeout = ms => new Promise(resolve => {\n  setTimeout(() => resolve(), ms)\n})\n\nexport const minimalFlow = () => ({\n  name: 'foo',\n  steps: {\n    one: {},\n    two: {}\n  }\n})\n\nexport const minimalFlowWithExtension = (bubble) => {\n  const flow = minimalFlow()\n  flow.foo = bubble === null\n    ? { bar: 'baz' }\n    : [{ bar: 'baz' }, bubble || 'all']\n  return flow\n}\n\nexport const asyncEvent = (wf, name, trigger) => new Promise((resolve, reject) => {\n  const handler = () => {\n    wf.off(name, handler)\n    resolve()\n  }\n  try {\n    wf.on(name, handler)\n    trigger()\n  } catch (e) {\n    reject(e)\n  }\n})\n\nexport const start = async (wf, trigger = () => wf.start()) => asyncEvent(wf, 'started', trigger)\n\nexport const next = async (wf, trigger = () => wf.current.complete()) => asyncEvent(wf, 'step', trigger)\n\nexport const end = async (wf, trigger = () => wf.current.complete()) => asyncEvent(wf, 'end', trigger)\n\nexport const error = async (wf, trigger) => asyncEvent(wf, 'error', trigger)\n\nexport const prev = async (wf) => {\n  const last = wf.history[wf.history.length - 1]\n  await next(wf, () => wf.step(last.name))\n}\n\nexport const setId = fn => internal => {\n  const original = internal.id\n  internal.id = fn\n  return () => {\n    internal.id = original\n  }\n}\n\nexport const props = (obj) => {\n  const p = []\n  for (; obj != null; obj = Object.getPrototypeOf(obj)) {\n    const op = Object.getOwnPropertyNames(obj)\n    for (let i = 0; i < op.length; i++) { if (p.indexOf(op[i]) === -1) p.push(op[i]) }\n  }\n  return p\n}\nexport const objectProps = props({})\n"],"names":["simpleId","Math","random","toString","substring","asyncTimeout","ms","Promise","resolve","setTimeout","minimalFlow","name","steps","one","two","minimalFlowWithExtension","bubble","flow","foo","bar","asyncEvent","wf","trigger","reject","handler","off","on","e","start","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_args","arguments","wrap","_callee$","_context","prev","next","length","undefined","abrupt","stop","_x","apply","_ref2","_callee2","_args2","_callee2$","_context2","current","complete","_x2","end","_ref3","_callee3","_args3","_callee3$","_context3","_x3","error","_ref4","_callee4","_callee4$","_context4","_x4","_x5","_ref5","_callee5","last","_callee5$","_context5","history","step","_x6","setId","fn","internal","original","id","props","obj","p","Object","getPrototypeOf","op","getOwnPropertyNames","i","indexOf","push","objectProps"],"mappings":"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"}